name: CI

on: [push, pull_request]

jobs:
  nix-build:
    name: nix-build (${{ matrix.os }})
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [macos-latest, ubuntu-latest]
    steps:
    - name: checkout
      uses: actions/checkout@v6
    - name: install nix
      uses: cachix/install-nix-action@v31
      with:
        github_access_token: ${{ github.token }}
    - name: build
      run: |
        SYSTEM=$(uname -m)-$(uname -s | tr '[:upper:]' '[:lower:]')
        case "$SYSTEM" in
          arm64-darwin) SYSTEM="aarch64-darwin" ;;
          x86_64-darwin) SYSTEM="x86_64-darwin" ;;
          aarch64-linux) SYSTEM="aarch64-linux" ;;
          x86_64-linux) SYSTEM="x86_64-linux" ;;
        esac
        nix build "./nix#homeConfigurations.${SYSTEM}.activationPackage" --impure --print-build-logs --show-trace
